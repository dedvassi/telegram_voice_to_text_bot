# Обновление Telegram Voice-to-Text Bot: Добавление функции генерации протоколов

## Что нового в обновлении

1. **Добавлена функция генерации протоколов встреч**
   - Команда `/protocol` для создания структурированных протоколов из голосовых сообщений
   - Автоматическое форматирование текста в профессиональный документ
   - Генерация PDF-файлов с корректным оформлением

2. **Исправлены ошибки и улучшена стабильность**
   - Решена проблема с обработкой временных директорий
   - Улучшена совместимость с различными версиями Python
   - Исправлены проблемы с зависимостями

3. **Улучшена документация**
   - Добавлены подробные инструкции по установке Ollama
   - Обновлены руководства по настройке и использованию

## Как обновить существующую установку

Если у вас уже установлен бот, выполните следующие шаги для обновления:

1. Перейдите в директорию проекта:
   ```
   cd путь/к/telegram_voice_to_text_bot
   ```

2. Получите последние изменения:
   ```
   git pull
   ```

3. Установите новые зависимости:
   ```
   pip install -r requirements.txt
   ```

4. Установите Ollama, следуя инструкциям в файле OLLAMA_SETUP.md

5. Создайте директорию для протоколов:
   ```
   mkdir -p protocols
   ```

## Решение возможных проблем

### Проблемы с установкой numpy

Если при установке зависимостей возникает ошибка с numpy, выполните:

```
python -m pip install --upgrade pip
pip install numpy==1.24.3 --only-binary=numpy
pip install -r requirements.txt --no-deps
pip install python-telegram-bot==20.4 ffmpeg-python==0.2.0 requests==2.31.0 markdown==3.4.3 tqdm==4.66.1 weasyprint==60.1
```

### Проблемы с ffmpeg

Убедитесь, что ffmpeg установлен и доступен в PATH:

**Windows (через Chocolatey):**
```
choco install ffmpeg
```

После установки перезапустите командную строку или перезагрузите компьютер.

### Проблемы с Ollama

Если возникают проблемы с Ollama:
1. Убедитесь, что Ollama запущен: `ollama list`
2. Проверьте, что модель загружена: `ollama pull llama3`

## Как использовать новую функцию

1. Запустите бота: `python src/bot.py`
2. Отправьте боту команду `/protocol`
3. Отправьте голосовое сообщение с резюме встречи
4. Получите готовый PDF-документ и текстовую версию протокола

## Дополнительная информация

- Все файлы протоколов сохраняются в директории `protocols`
- Для настройки формата протоколов можно изменить шаблон в файле `src/protocol_generator.py`
- Для тестирования функции генерации протоколов можно использовать скрипт `tests/validate_protocol_generator.py`

## Контакты для поддержки

Если у вас возникнут вопросы или проблемы, пожалуйста, создайте issue в репозитории GitHub:
https://github.com/dedvassi/telegram_voice_to_text_bot/issues
