# Руководство по установке и использованию Telegram Voice-to-Text Bot

Это подробное руководство поможет вам установить и настроить Telegram бота для преобразования голосовых сообщений в текст. Бот поддерживает два бесплатных движка распознавания речи: OpenAI Whisper и Vosk.

## Содержание

1. [Предварительные требования](#предварительные-требования)
2. [Установка](#установка)
3. [Настройка](#настройка)
4. [Запуск бота](#запуск-бота)
5. [Использование](#использование)
6. [Выбор движка распознавания речи](#выбор-движка-распознавания-речи)
7. [Устранение неполадок](#устранение-неполадок)
8. [Дополнительные настройки](#дополнительные-настройки)

## Предварительные требования

Перед установкой бота убедитесь, что у вас установлены:

1. **Python 3.8 или выше**
   - Для Windows: Скачайте и установите с [официального сайта Python](https://www.python.org/downloads/)
   - Для Ubuntu/Debian: `sudo apt update && sudo apt install python3 python3-pip python3-venv`
   - Для macOS: `brew install python` (требуется [Homebrew](https://brew.sh/))

2. **FFmpeg**
   - Для Windows: Скачайте с [официального сайта](https://ffmpeg.org/download.html) или установите через [Chocolatey](https://chocolatey.org/): `choco install ffmpeg`
   - Для Ubuntu/Debian: `sudo apt update && sudo apt install ffmpeg`
   - Для macOS: `brew install ffmpeg`

3. **Git** (опционально, для клонирования репозитория)
   - Для Windows: Скачайте и установите с [официального сайта Git](https://git-scm.com/download/win)
   - Для Ubuntu/Debian: `sudo apt update && sudo apt install git`
   - Для macOS: `brew install git`

4. **Токен Telegram бота**
   - Создайте нового бота через [@BotFather](https://t.me/BotFather) в Telegram
   - Сохраните полученный токен для дальнейшей настройки

## Установка

### Шаг 1: Клонирование репозитория

```bash
git clone https://github.com/dedvassi/telegram_voice_to_text_bot.git
cd telegram_voice_to_text_bot
```

Альтернативно, вы можете скачать ZIP-архив репозитория и распаковать его.

### Шаг 2: Создание виртуального окружения

```bash
# Для Windows
python -m venv venv
venv\Scripts\activate

# Для Linux/macOS
python3 -m venv venv
source venv/bin/activate
```

### Шаг 3: Установка зависимостей

```bash
pip install -r requirements.txt
```

Примечание: Установка Whisper может занять некоторое время, особенно на слабых компьютерах.

### Шаг 4: Установка дополнительных компонентов (в зависимости от выбранного движка)

#### Для Whisper

Whisper будет автоматически загружать модели при первом запуске. Модели занимают от 150 МБ до 3 ГБ в зависимости от размера.

#### Для Vosk

Скачайте модель для нужного языка с [официального сайта Vosk](https://alphacephei.com/vosk/models):

```bash
# Создайте директорию для моделей
mkdir -p model

# Скачайте модель (пример для русского языка)
wget https://alphacephei.com/vosk/models/vosk-model-ru-0.22.zip
unzip vosk-model-ru-0.22.zip -d model
mv model/vosk-model-ru-0.22/* model/
rmdir model/vosk-model-ru-0.22

# Для английского языка
# wget https://alphacephei.com/vosk/models/vosk-model-small-en-us-0.15.zip
# unzip vosk-model-small-en-us-0.15.zip -d model
# mv model/vosk-model-small-en-us-0.15/* model/
# rmdir model/vosk-model-small-en-us-0.15
```

## Настройка

### Шаг 1: Создание файла конфигурации

Создайте файл `.env` в корневой директории проекта:

```bash
touch .env
```

### Шаг 2: Настройка переменных окружения

Откройте файл `.env` в любом текстовом редакторе и добавьте следующие строки:

```
# Токен Telegram бота (обязательно)
TELEGRAM_TOKEN=ваш_токен_от_botfather

# Движок распознавания речи: "whisper" или "vosk"
SPEECH_RECOGNITION_ENGINE=whisper

# Настройки для Whisper (если выбран whisper)
WHISPER_MODEL=tiny  # tiny, base, small, medium, large

# Настройки для Vosk (если выбран vosk)
VOSK_MODEL_PATH=model

# Директория для временных файлов
TEMP_DIR=temp

# Настройки логирования
LOG_LEVEL=INFO
LOG_FILE=bot.log
```

Замените `ваш_токен_от_botfather` на токен, полученный от @BotFather.

## Запуск бота

### Запуск в обычном режиме

```bash
# Убедитесь, что вы находитесь в виртуальном окружении
# Для Windows
venv\Scripts\activate

# Для Linux/macOS
source venv/bin/activate

# Запуск бота
cd src
python bot.py
```

### Запуск в фоновом режиме (только для Linux/macOS)

```bash
nohup python src/bot.py > bot_output.log 2>&1 &
```

### Запуск с помощью systemd (для Linux)

1. Создайте файл службы:

```bash
sudo nano /etc/systemd/system/telegram-voice-to-text.service
```

2. Добавьте следующее содержимое (замените пути на ваши):

```
[Unit]
Description=Telegram Voice-to-Text Bot
After=network.target

[Service]
User=ваш_пользователь
WorkingDirectory=/путь/к/telegram_voice_to_text_bot
ExecStart=/путь/к/telegram_voice_to_text_bot/venv/bin/python /путь/к/telegram_voice_to_text_bot/src/bot.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

3. Включите и запустите службу:

```bash
sudo systemctl enable telegram-voice-to-text
sudo systemctl start telegram-voice-to-text
```

4. Проверьте статус:

```bash
sudo systemctl status telegram-voice-to-text
```

## Использование

1. Откройте Telegram и найдите вашего бота по имени
2. Нажмите кнопку "Start" или отправьте команду `/start`
3. Отправьте голосовое сообщение
4. Бот обработает сообщение и вернет его текстовую расшифровку

### Доступные команды

- `/start` - Начать работу с ботом
- `/help` - Показать справку
- `/about` - Информация о боте

## Выбор движка распознавания речи

Бот поддерживает два движка распознавания речи:

### OpenAI Whisper

**Преимущества:**
- Высокая точность распознавания
- Поддержка множества языков
- Не требует скачивания отдельных моделей для каждого языка

**Недостатки:**
- Требует больше вычислительных ресурсов
- Медленнее работает на слабых устройствах

**Рекомендуется для:**
- Серверов с достаточными ресурсами
- Случаев, когда требуется высокая точность
- Многоязычных приложений

### Vosk

**Преимущества:**
- Быстрая работа даже на слабых устройствах
- Меньше потребление памяти
- Работает полностью офлайн

**Недостатки:**
- Требует отдельную модель для каждого языка
- Немного ниже точность по сравнению с Whisper

**Рекомендуется для:**
- Raspberry Pi и других маломощных устройств
- Случаев, когда скорость важнее точности
- Приложений с ограниченными ресурсами

## Устранение неполадок

### Проблема: Бот не отвечает

**Решение:**
1. Проверьте, запущен ли бот
2. Проверьте правильность токена в файле `.env`
3. Проверьте логи на наличие ошибок: `cat bot.log`

### Проблема: Ошибка "No module named X"

**Решение:**
1. Убедитесь, что вы активировали виртуальное окружение
2. Переустановите зависимости: `pip install -r requirements.txt`

### Проблема: Ошибка при распознавании речи

**Решение:**
1. Проверьте установку FFmpeg: `ffmpeg -version`
2. Для Vosk: проверьте, что модель скачана и путь указан правильно
3. Для Whisper: проверьте, что модель указана правильно и соответствует доступным ресурсам

### Проблема: Высокое потребление памяти

**Решение:**
1. Используйте модель Whisper меньшего размера (tiny или base)
2. Переключитесь на Vosk, если ресурсы ограничены

## Дополнительные настройки

### Изменение модели Whisper

Модели Whisper различаются по размеру и точности:

- `tiny`: ~150 МБ, самая быстрая, но наименее точная
- `base`: ~300 МБ, хороший баланс между скоростью и точностью
- `small`: ~1 ГБ, более точная, но медленнее
- `medium`: ~2 ГБ, высокая точность, требует больше ресурсов
- `large`: ~3 ГБ, самая точная, но самая медленная

Для изменения модели отредактируйте параметр `WHISPER_MODEL` в файле `.env`.

### Настройка логирования

Для изменения уровня логирования отредактируйте параметр `LOG_LEVEL` в файле `.env`:

- `DEBUG`: Подробная отладочная информация
- `INFO`: Общая информация (по умолчанию)
- `WARNING`: Только предупреждения и ошибки
- `ERROR`: Только ошибки
- `CRITICAL`: Только критические ошибки

Для изменения файла логов отредактируйте параметр `LOG_FILE` в файле `.env`.

### Настройка временной директории

Для изменения директории временных файлов отредактируйте параметр `TEMP_DIR` в файле `.env`.
